import { Callout } from 'nextra/components'
import { Tabs, Tab } from 'nextra/components'

# Run Jots

[Jots](https://jots.social) is the first decentralized social app built with WeaveDB.

The entire codebase is open source and available on [GitHub](https://github.com/weavedb/weavedb/tree/master/examples/jots). You can download, modify, and run it on your own.  

## Prerequisites

- To effectively follow this tutorial, you should be familiar with the development workflow as per the guide: [Run Local Test](/development/run-local-test) and [Run Rollup Node](/rollup-node/run-rollup-node)

- Make sure that you have a local rollup node up and running.

- WeaveDB repository needs to be cloned to your local machine. For instructions, see [this guide](/development/clone-the-repo)

## Generate Accounts

From the root directory of your local [WeaveDB repo](/development/clone-the-repo), run the following commands in the terminal to navigate to the `db` directory of the Jots project and generate keys for the `owner` and the `relayer`.

```bash copy
cd examples/jots/db
```

<Tabs items={['yarn', 'npm']}>
  <Tab>
  ```bash copy
yarn keygen owner
yarn keygen relayer
  ```
  </Tab>
  <Tab>
  ```bash copy
npm keygen owner
npm keygen relayer
  ```
  </Tab>
</Tabs>

The generated accounts will be stored within the Jots project in the `/db/.weavedb/accounts/evm` directory, named `owner.json` and `relayer.json`, respectively.

## Configure the Database

<Callout type="warning" emoji="⚠️">
The admin account for the database must match with the admin of the rollup node. Locate and copy the `admin` privateKey from the `weavedb.standalone.config.js` file found at `weavedb/grpc-node/node-server/weavedb.standalone.config.js`, which was created in [this guide](/rollup-node/run-rollup-node#write-configuration)
</Callout>

Next, you will need to edit the `weavedb.config.js` file within the Jots project directory at `weavedb/examples/jots/db/weavedb.config.js`. Update this config file with the copied admin `privateKey`

```js copy filename="/weavedb.config.js"
module.exports = {
  db: {
    app: "http://localhost:3000",
    name: "Jots",                   // Database Instance
    rollup: false,                  // Disable rollup for local testing
    plugins: { notifications: {} }, // Jots uses notifications plugin
	tick: 1000 * 60 * 5             // Record cron job result every 5 minutes
  },
  accounts: {
    evm: {
      admin: { privateKey: "0x" }, // Replace string value with your copied admin privateKey
    },
    ar: {},
  },
  defaultNetwork: "localhost",
  networks: {
    localhost: { url: "localhost:8080", admin: "admin" },
  },
}
```

## Deploy the Database

From the `db` directory of the Jots project, run the following commands in the terminal to deploy and set up a database instance.

<Tabs items={['yarn', 'npm']}>
  <Tab>
  ```bash copy
yarn deploy jots --owner owner
  ```
  </Tab>
  <Tab>
  ```bash copy
npm deploy jots --owner owner
  ```
  </Tab>
</Tabs>

Then, configure the instance with the database settings.

<Tabs items={['yarn', 'npm']}>
  <Tab>
  ```bash copy
yarn setup jots --owner owner --relayer relayer
yarn setup jots --owner owner --plugin notifications # set up plugin DB
  ```
  </Tab>
  <Tab>
  ```bash copy
npm setup jots --owner owner --relayer relayer
npm setup jots --owner owner --plugin notifications # set up plugin DB
  ```
  </Tab>
</Tabs>

Now your Jots database is all set and deployed in your local rollup node.

## Initialize Jots User

To get started with the Jots application, run the following script in the terminal. Make sure your terminal is in the `db` directory of the Jots project. This script will invite an initial user with an allocation of 100 invitation credits.

<Callout type="warning" emoji="⚠️">
Replace `0xUser_Address` with the Ethereum address of the user you wish to invite.
</Callout>

```bash copy
node scripts/initJots.js jots --owner owner --user 0xUser_Address
```

## Set up the Frontend

From the `db` directory of the Jots project, run the following command in the terminal to navigate to the `app` directory and install the necessary dependencies.

<Tabs items={['yarn', 'npm']}>
  <Tab>
  ```bash copy
cd ../app
yarn
  ```
  </Tab>
  <Tab>
  ```bash copy
cd ../app
npm install
  ```
  </Tab>
</Tabs>

### Set up environmental variables

<Callout type="info" emoji="💡">
For media storage, Jots currently utilizes Google Cloud Storage (GCS), and you will need to set up corresponding environment variables with credentials obtained from a service-account-json file.
This file can be generated in the [Firebase Console](https://console.firebase.google.com). We have plans to switch to [Irys (Bundlr)](https://irys.xyz) for storage solutions in the future.
</Callout>

Create or edit your `.env.local` file in the `app` directory of the Jots project with the following content, replacing placeholders with actual values:

```js copy filename="/.env.local"
NEXT_PUBLIC_RPC="http://localhost:8080"
RPC="0.0.0.0:8080"
NEXT_PUBLIC_TXID="jots"
RELAYER_PRIVATE_KEY="relayer_private_key"

GCS_BUCKET="project_id.appspot.com"
GCS_PROJECT_ID="project_id"
GCS_EMAIL="firebase-adminsdk-xyz@project_id.iam.gserviceaccount.com"
GCS_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----\n"
```

- If rollup was enabled during database deployment, `NEXT_PUBLIC_TXID` should be set to the `contractTxId`. You can find this value at [scan.weavedb.dev/node/localhost/db/db_name](https://scan.weavedb.dev/node/localhost/db/db_name) — make sure to replace `db_name` at the end of the URL with the actual name of your database as specified during [deployment](/development/run-jots#deploy-the-database).

- Use the relayer's actual privateKey, which you generated in the [previous step](/development/run-jots#generate-accounts) of this guide.

### Run on Localhost

From the `app` directory of the Jots project, run the following command in the terminal to start the Jots application on your localhost.

<Tabs items={['yarn', 'npm']}>
  <Tab>
  ```bash copy
yarn dev
  ```
  </Tab>
  <Tab>
  ```bash copy
npm run dev
  ```
  </Tab>
</Tabs>

The Jots app should now be accessible at [localhost:3000](http://localhost:3000)